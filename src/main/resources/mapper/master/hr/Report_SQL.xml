<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.seedit.domain.mapper.seedit.ReportDao">
	
	<select id="findERPIUData" parameterType="kr.co.seedit.domain.hr.dto.ReportParamsDto" resultType="kr.co.seedit.domain.hr.dto.SalaryExcelDto">
		 /*ReportDao.findERPIUData*/
		 SELECT  fc.attribute1  AS cd_company -- 회사코드
		      , fbe.attribute1 AS cd_bizarea -- 사업장코드
		      , hdcs.yyyymm AS ym -- 년월
		      , he.employment_code AS cd_emp -- 고용형태
		      , he.employee_type AS tp_emp -- 사원구분
		      , 001 AS tp_pay -- 급여구분
		      , 1 AS no_seq -- 순번
		      , he.employee_number AS no_emp -- 사번
		      , hdcs.basic_salary  AS am_pay01 -- 기본급
		      , ifnull(hdcs.attribute01,0)+ifnull(hdcs.attribute15,0) AS am_pay02
		      , hdcs.attribute02 AS am_pay03
		      , hdcs.attribute03 AS am_pay04
		      , ifnull(hdcs.attribute04,0) + ifnull(hdcs.attribute18,0) AS am_pay05
		      , hdcs.attribute05 AS am_pay06
		      , hdcs.attribute06 AS am_pay07
		      , hdcs.attribute07 AS am_pay08
		      , hdcs.attribute08 AS am_pay09
		      , hdcs.attribute09 AS am_pay10
		      , hdcs.attribute10 AS am_pay11
		      , hdcs.attribute11 AS am_pay12
		      , hdcs.attribute12 AS am_pay13
		FROM    hr_dh_calc_salary hdcs
		      INNER JOIN fnd_company fc 
		      ON hdcs.company_id = fc.company_id
		      INNER JOIN fnd_business_est fbe 
		      ON hdcs.company_id = fbe.company_id
		      INNER JOIN hr_employee he 
		      ON hdcs.company_id = he.company_id
		      AND hdcs.employee_id = he.employee_id
		      AND hdcs.yyyymm = he.attribute1
		      AND he.est_id = fbe.est_id 
		WHERE  fc.company_id  = #{companyId}
		<if test="estId !=999 and estId != null">
		AND	he.est_id = #{estId}
		</if>
	    AND hdcs.yyyymm =  #{yyyymm}
	</select>

	<select id="findPayrollData" parameterType="kr.co.seedit.domain.hr.dto.ReportParamsDto" resultType="kr.co.seedit.domain.hr.dto.ReportPayrollDto">
		/*ReportDao.findPayrollData*/
		SELECT he.employee_id
		, he.employee_number
        , he.korean_name
        , fbe.est_name
        , hd.department_name
        , fcd02.defined_name
        , CASE WHEN IFNULL(fcd06.defined_cd, '99999') = '100' THEN 0 ELSE 1 END as check_first
		, CASE WHEN IFNULL(fcd06.defined_cd, '99999') = '201' THEN 1 ELSE 0 END as check_special
        , he.employee_type
        , he.hire_date
        , IF(he.retire_date != '9999-12-31', he.retire_date, null)
        , IFNULL(hdcs.basic_salary,0) AS basic_salary
		, ifnull(hdcs.attribute01,0)+ifnull(hdcs.attribute15,0) AS annual_allowance
        , IFNULL(hdcs.attribute02,0) AS overtime_allowance01
        , IFNULL(hdcs.attribute03,0) AS overtime_allowance02
		, ifnull(hdcs.attribute04,0) + ifnull(hdcs.attribute18,0) AS night_allowance01
        , IFNULL(hdcs.attribute05,0) AS night_allowance02
        , IFNULL(hdcs.attribute06,0) AS holiday_allowance01
        , IFNULL(hdcs.attribute07,0) AS holiday_allowance02
        , IFNULL(hdcs.attribute08,0) AS position_allowance
        , IFNULL(hdcs.attribute09,0) AS other_allowances
        , IFNULL(hdcs.attribute10,0) AS subsidies
        , IFNULL(hdcs.attribute11,0) AS transportation_expenses
        , IFNULL(hdcs.attribute12,0) AS meals_expenses
        , IFNULL(hb.bonus_amount,0) AS bonus_amount
        , IFNULL(hdcs.basic_salary,0) + ifnull(hdcs.attribute01,0)+ifnull(hdcs.attribute15,0)  + IFNULL(hdcs.attribute02,0) + IFNULL(hdcs.attribute03,0)
		  + ifnull(hdcs.attribute04,0) + ifnull(hdcs.attribute18,0) + IFNULL(hdcs.attribute05,0) + IFNULL(hdcs.attribute06,0) + IFNULL(hdcs.attribute07,0)
		  + IFNULL(hdcs.attribute08,0) + IFNULL(hdcs.attribute09,0) + IFNULL(hdcs.attribute10,0) + IFNULL(hdcs.attribute11,0) 
		  + IFNULL(hdcs.attribute12,0) + IFNULL(hb.bonus_amount,0)	AS salary_sum
		, IFNULL(hdt.AM_DEDUCT01,0) AS national_pension
		, IFNULL(hdt.AM_DEDUCT02,0) AS health_insurance
		, IFNULL(hdt.AM_DEDUCT03,0) AS care_insurance
		, IFNULL(hdt.AM_DEDUCT04,0) AS employment_insurance
		, IFNULL(hdt.AM_DEDUCT05,0) AS advance
		, IFNULL(hdt.AM_DEDUCT06,0) AS other_tax
		, IFNULL(hdt.AM_DEDUCT07,0) AS gyeongjobi
		, IFNULL(hdt.AM_DEDUCT08,0) + IFNULL(hdt.AM_DEDUCT09,0) AS yearend
		, IFNULL(hdt.AM_DEDUCT10,0) AS health_insurance_settlement
		, IFNULL(hdt.AM_DEDUCT11,0) AS care_insurance_settlement
		, IFNULL(hdt.AM_DEDUCT12,0) AS holiday_tax
		, IFNULL(hdt.AM_INCOMTAX,0) AS incomtax
		, IFNULL(hdt.AM_RESIDTAX,0) AS residtax
		, IFNULL(hdt.AM_DEDUCT01,0) + IFNULL(hdt.AM_DEDUCT02,0) + IFNULL(hdt.AM_DEDUCT03,0) + IFNULL(hdt.AM_DEDUCT04,0)
		  + IFNULL(hdt.AM_DEDUCT05,0) + IFNULL(hdt.AM_DEDUCT06,0) + IFNULL(hdt.AM_DEDUCT07,0) + IFNULL(hdt.AM_DEDUCT08,0) 
		  + IFNULL(hdt.AM_DEDUCT09,0) + IFNULL(hdt.AM_DEDUCT10,0) + IFNULL(hdt.AM_DEDUCT11,0) + IFNULL(hdt.AM_DEDUCT12,0)
		  + IFNULL(hdt.AM_INCOMTAX,0) + IFNULL(hdt.AM_RESIDTAX,0) AS tax_sum
		, IFNULL(hdt.DT_PAY,'00000000') AS dt_pay
        FROM   hr_dh_calc_salary hdcs
        INNER JOIN fnd_business_est fbe
        ON hdcs.company_id = fbe.company_id
        INNER JOIN hr_employee he
        ON hdcs.company_id  = he.company_id
        AND hdcs.employee_id  = he.employee_id
        AND hdcs.yyyymm  = he.attribute1
        AND he.est_id = fbe.est_id
        -- 부서
        INNER JOIN hr_department  hd
        ON he.company_id = hd.company_id
        AND he.department_id = hd.department_id
        AND he.attribute1  = hd.attribute2
        -- 직급
        INNER JOIN fnd_code fc02
        ON fc02.company_id  = he.company_id
        AND fc02.code_field = 'HR_A0003'
        INNER JOIN fnd_code_detail fcd02
        ON fcd02.company_id  = he.company_id
        AND fcd02.code_id = fc02.code_id
        AND fcd02.defined_cd = he.position_code
        -- 직위순서
		LEFT JOIN fnd_code fc07
		ON fc07.company_id  = he.company_id
		AND fc07.code_field = 'HR_A0007'
		INNER JOIN fnd_code_detail fcd07
		ON fcd07.company_id  = fc07.company_id 
		AND fcd07.code_id = fc07.code_id
		AND fcd07.defined_cd = he.position_code
		-- 직군
		LEFT JOIN fnd_code fc06
		ON fc06.company_id  = he.company_id 
		AND fc06.code_field = 'HR_A0006'
		LEFT JOIN fnd_code_detail fcd06
		ON fcd06.company_id  = he.company_id 
		AND fcd06.code_id = fc06.code_id
		AND fcd06.defined_cd = he.duty_type
		-- AND fcd06.defined_cd = 100 -- 임원
        -- 상여
        LEFT JOIN hr_bonus hb
        ON he.company_id = hb.company_id
        AND he.employee_id = hb.employee_id
        AND he.attribute1 = hb.yyyymm
        -- 세금
        LEFT JOIN hr_dh_tax hdt 
        ON he.company_id = hdt.company_id
        AND he.employee_id = hdt.employee_id
        AND he.attribute1 = hdt.yyyymm
        WHERE  he.company_id = #{companyId}
        <if test="estId !=999 and estId != null">
            AND   he.est_id = #{estId}
        </if>
        AND   he.attribute1  = #{yyyymm}
        ORDER BY check_first -- 임원
		, he.est_id -- 사업장
		, IFNULL(hd.order_index,'99999') -- 부서정렬
		, check_special
		, IFNULL(fcd07.value01, '99999') -- 직급정렬
		, he.employee_number -- 사번
	</select>
	
	<select id="findEstPayrollData" parameterType="kr.co.seedit.domain.hr.dto.ReportParamsDto" resultType="kr.co.seedit.domain.hr.dto.ReportPayrollDto">
		/*ReportDao.findEstPayrollData*/
		SELECT fbe.est_name
		, count(*) AS cnt
		, sum(IFNULL(hdcs.basic_salary,0)) AS basic_salary
		, sum(ifnull(hdcs.attribute01,0)) + sum(ifnull(hdcs.attribute15,0)) AS annual_allowance
		, sum(IFNULL(hdcs.attribute02,0)) AS overtime_allowance01
		, sum(IFNULL(hdcs.attribute03,0)) AS overtime_allowance02
		, sum(ifnull(hdcs.attribute04,0)) + sum(ifnull(hdcs.attribute18,0)) AS night_allowance01
		, sum(IFNULL(hdcs.attribute05,0)) AS night_allowance02
		, sum(IFNULL(hdcs.attribute06,0)) AS holiday_allowance01
		, sum(IFNULL(hdcs.attribute07,0)) AS holiday_allowance02
		, sum(IFNULL(hdcs.attribute08,0)) AS position_allowance
		, sum(IFNULL(hdcs.attribute09,0)) AS other_allowances
		, sum(IFNULL(hdcs.attribute10,0)) AS subsidies
		, sum(IFNULL(hdcs.attribute11,0)) AS transportation_expenses
		, sum(IFNULL(hdcs.attribute12,0)) AS meals_expenses
		, sum(IFNULL(hb.bonus_amount,0)) AS bonus_amount
		, sum(IFNULL(hdcs.basic_salary,0)) + sum(ifnull(hdcs.attribute01,0)) + sum(ifnull(hdcs.attribute15,0)) + sum(IFNULL(hdcs.attribute02,0)) + sum(IFNULL(hdcs.attribute03,0))
			+ sum(ifnull(hdcs.attribute04,0)) + sum(ifnull(hdcs.attribute18,0)) + sum(IFNULL(hdcs.attribute05,0)) + sum(IFNULL(hdcs.attribute06,0)) + sum(IFNULL(hdcs.attribute07,0))
			+ sum(IFNULL(hdcs.attribute08,0)) + sum(IFNULL(hdcs.attribute09,0)) + sum(IFNULL(hdcs.attribute10,0)) + sum(IFNULL(hdcs.attribute11,0))
			+ sum(IFNULL(hdcs.attribute12,0)) + sum(IFNULL(hb.bonus_amount,0)) AS salary_sum
		, sum(IFNULL(hdt.AM_DEDUCT01,0)) AS national_pension
		, sum(IFNULL(hdt.AM_DEDUCT02,0)) AS health_insurance
		, sum(IFNULL(hdt.AM_DEDUCT03,0)) AS care_insurance
		, sum(IFNULL(hdt.AM_DEDUCT04,0)) AS employment_insurance
		, sum(IFNULL(hdt.AM_DEDUCT05,0)) AS advance
		, sum(IFNULL(hdt.AM_DEDUCT06,0)) AS other_tax
		, sum(IFNULL(hdt.AM_DEDUCT07,0)) AS gyeongjobi
		, sum(IFNULL(hdt.AM_DEDUCT08,0)) + sum(IFNULL(hdt.AM_DEDUCT09,0)) AS yearend
		, sum(IFNULL(hdt.AM_DEDUCT10,0)) AS health_insurance_settlement
		, sum(IFNULL(hdt.AM_DEDUCT11,0)) AS care_insurance_settlement
		, sum(IFNULL(hdt.AM_DEDUCT12,0)) AS holiday_tax
		, sum(IFNULL(hdt.AM_INCOMTAX,0)) AS incomtax
		, sum(IFNULL(hdt.AM_RESIDTAX,0)) AS residtax
		, sum(IFNULL(hdt.AM_DEDUCT01,0)) + sum(IFNULL(hdt.AM_DEDUCT02,0)) + sum(IFNULL(hdt.AM_DEDUCT03,0)) + sum(IFNULL(hdt.AM_DEDUCT04,0))
			+ sum(IFNULL(hdt.AM_DEDUCT05,0)) + sum(IFNULL(hdt.AM_DEDUCT06,0)) + sum(IFNULL(hdt.AM_DEDUCT07,0)) + sum(IFNULL(hdt.AM_DEDUCT08,0))
			+ sum(IFNULL(hdt.AM_DEDUCT09,0)) + sum(IFNULL(hdt.AM_DEDUCT10,0)) + sum(IFNULL(hdt.AM_DEDUCT11,0)) + sum(IFNULL(hdt.AM_DEDUCT12,0))
			+ sum(IFNULL(hdt.AM_INCOMTAX,0)) + sum(IFNULL(hdt.AM_RESIDTAX,0)) AS tax_sum
		, IFNULL(hdt.DT_PAY,'00000000') AS dt_pay
		FROM hr_dh_calc_salary hdcs
		INNER JOIN fnd_business_est fbe
		ON hdcs.company_id = fbe.company_id
		INNER JOIN hr_employee he
		ON hdcs.company_id = he.company_id
		AND hdcs.employee_id = he.employee_id
		AND hdcs.yyyymm = he.attribute1
		AND he.est_id = fbe.est_id
		INNER JOIN hr_department hd
		ON he.company_id = hd.company_id
		AND he.department_id = hd.department_id
		AND he.attribute1 = hd.attribute2
		INNER JOIN fnd_code fc02
		ON fc02.company_id = he.company_id
		AND fc02.code_field = 'HR_A0003'
		INNER JOIN fnd_code_detail fcd02
		ON fcd02.company_id = he.company_id
		AND fcd02.code_id = fc02.code_id
		AND fcd02.defined_cd = he.position_code
		LEFT JOIN hr_bonus hb
		ON he.company_id = hb.company_id
		AND he.employee_id = hb.employee_id
		AND he.attribute1 = hb.yyyymm
		LEFT JOIN hr_dh_tax hdt
		ON he.company_id = hdt.company_id
		AND he.employee_id = hdt.employee_id
		AND he.attribute1 = hdt.yyyymm
		WHERE he.company_id = #{companyId}
		AND he.attribute1  = #{yyyymm}
		GROUP BY fbe.est_name
		ORDER BY fbe.est_id
	</select>
	
<!--	<select id="findEmployees" parameterType="kr.co.seedit.domain.hr.dto.ReportParamsDto" resultType="kr.co.seedit.domain.hr.dto.PersonalPayrollParamsDto">
		/*ReportDao.findEmployees*/
		SELECT DISTINCT(he.employee_id)
				,he.korean_name
				,he.employee_type
		FROM hr_employee he
		INNER JOIN hr_dh_adt_manage hadt
           ON hadt.company_id  = he.company_id
           AND hadt.employee_id = he.employee_id
           AND hadt.attribute1 = he.attribute1
		WHERE  he.company_id = #{companyId}
        <if test="estId !=999 and estId != null">
            AND   he.est_id = #{estId}
        </if>
        AND   he.attribute1  = #{yyyymm}
        ORDER BY he.department_id, he.position_code
	</select>
-->
	<select id="findPersonalPayroll" parameterType="kr.co.seedit.domain.hr.dto.ReportParamsDto" resultType="kr.co.seedit.domain.hr.dto.EmployeeInformationDto">
		/*ReportDao.findPersonalPayroll*/
		SELECT hadt.work_date -- 근태기준일
	           , fbe.est_name -- 사업장
	           , hd.department_name -- 부서
	           , he.employee_number  -- 사원번호
	           , he.korean_name -- 성명
	           , fcd02.defined_name -- 직급
	           , hadt.work_status -- 근무형태
	           , hadt.work_start_date -- 출근일시
	           , hadt.work_end_date -- 퇴근일시
	           , hadt.in_status -- 출근판정
	           , hadt.out_status -- 퇴근판정
	           , hadt.out_start_date
	           , hadt.out_end_date
	           , TIME_FORMAT(TIMEDIFF(hadt.out_end_date, hadt.out_start_date ), '%H:%i')  AS out_time
	           , hadt.late_time -- 지각
	           , hadt.over_time -- 연장근무기간
	           , hadt.night_time -- 야간근무시간
	           , hadt.holiday_time -- 휴일
	           , hadt.real_work_time -- 실제근무시간
	           , hadt.default_time  -- 정상근무시간
	           , fcd01.defined_name -- 급여구분
	    FROM   hr_employee he
	           INNER JOIN hr_department hd
	           ON he.company_id = hd.company_id
	           AND he.department_id = hd.department_id
	           AND he.attribute1 = hd.attribute2
	           -- 급여구분
	           INNER JOIN fnd_code fc01
	           ON fc01.company_id  = he.company_id
	           AND fc01.code_field = 'HR_A0002'
	           INNER JOIN fnd_code_detail fcd01
	           ON fcd01.company_id  = he.company_id
	           AND fcd01.code_id = fc01.code_id
	           AND fcd01.value01  = he.employee_type
	           -- 직급
	           INNER JOIN fnd_code fc02
	           ON fc02.company_id  = he.company_id
	           AND fc02.code_field = 'HR_A0003'
	           INNER JOIN fnd_code_detail fcd02
	           ON fcd02.company_id  = he.company_id
	           AND fcd02.code_id = fc02.code_id
	           AND fcd02.defined_cd = he.position_code
	           -- 사업장
	           INNER JOIN fnd_business_est fbe
	           ON fbe.company_id  = he.company_id
	           AND fbe.est_id  = he.est_id
	           INNER JOIN hr_dh_adt_manage hadt
	           ON hadt.company_id  = he.company_id
	           AND hadt.employee_id = he.employee_id
	           AND hadt.attribute1 = he.attribute1
	    WHERE he.company_id  = #{companyId}
	    	<if test="estId !=999">
				AND	he.est_id = #{estId}
			</if>
	    AND   he.attribute1  = #{yyyymm}
	    AND	  he.employee_id = #{employeeId}
	    ORDER BY hadt.work_date
	</select>
	
<!--
	<select id="findPayroll" parameterType="kr.co.seedit.domain.hr.dto.MonthlyKeunTaeDto" resultType="kr.co.seedit.domain.hr.dto.ReportMonthlyKeunTaeDto">
		SELECT he.korean_name
				,fcd02.defined_name
				,hd.department_name
				,he.hire_date
				,he.employee_type
				,annual_leave_used
				,annual_leave_used_day
				,IFNULL(overtime_1, 0) AS overtime_1
				,IFNULL(overtime_2, 0) AS overtime_2
				,IFNULL(night_shift_1, 0) AS night_shift_1
				,IFNULL(night_shift_2, 0) AS night_shift_2
				,IFNULL(daytime_hours, 0) AS daytime_hours
				,IFNULL(nighttime_hours, 0) AS nighttime_hours
				,IFNULL(holiday_saturday_1, 0) AS holiday_saturday_1
				,IFNULL(holiday_sunday_1, 0) AS holiday_sunday_1
				,IFNULL(holiday_2, 0) AS holiday_2
				,IFNULL(transportation, 0) AS transportation
				,IFNULL(meal, 0) AS meal
				,IFNULL(other, 0) AS other
				,IFNULL(half_day, 0) AS half_day
				,IFNULL(half_time, 0) AS half_time
				,IFNULL(early_leave_day, 0) AS early_leave_day
				,IFNULL(early_leave_time, 0) AS early_leave_time
				,IFNULL(late_day, 0) AS late_day
				,IFNULL(late_time, 0) AS late_time
		FROM hr_dh_monthly_keun_tae hdmkt 
			INNER JOIN hr_employee he 
					ON he.company_id = hdmkt.company_id
						AND he.employee_id = hdmkt.employee_id 
			INNER JOIN fnd_code fc02
					ON fc02.company_id = hdmkt.company_id 
						AND fc02.code_field = 'HR_A0003'
			INNER JOIN fnd_code_detail fcd02
					ON fcd02.company_id = hdmkt.company_id 
						AND fcd02.code_id = fc02.code_id 
						AND fcd02.defined_cd = he.position_code
			INNER JOIN hr_department hd 
					ON hd.company_id = hdmkt.company_id 
						AND hd.department_id = he.department_id
						AND hd.attribute2 = he.attribute1
		WHERE hdmkt.company_id = #{companyId}
		AND hdmkt.yyyymm = #{yyyymm}
	</select>
-->
	<select id="findPayStubForMail" parameterType="kr.co.seedit.domain.hr.dto.ReportParamsDto" resultType="kr.co.seedit.domain.hr.dto.ReportPayrollDto">
		/*ReportDao.findPayStubForMail*/
		SELECT he.employee_number
        , he.korean_name
        , he.email_address
        , he.resident_registration_number
        , fbe.est_name
        , hd.department_name
        , fcd02.defined_name
        , he.employee_type
        , he.hire_date
        , IF(he.retire_date != '9999-12-31', he.retire_date, null)
        , IFNULL(hdcs.basic_salary,0) AS basic_salary
		, ifnull(hdcs.attribute01,0)+ifnull(hdcs.attribute15,0) AS annual_allowance
        , IFNULL(hdcs.attribute02,0) AS overtime_allowance01
        , IFNULL(hdcs.attribute03,0) AS overtime_allowance02
		, ifnull(hdcs.attribute04,0) + ifnull(hdcs.attribute18,0) AS night_allowance01
        , IFNULL(hdcs.attribute05,0) AS night_allowance02
        , IFNULL(hdcs.attribute06,0) AS holiday_allowance01
        , IFNULL(hdcs.attribute07,0) AS holiday_allowance02
        , IFNULL(hdcs.attribute08,0) AS position_allowance
        , IFNULL(hdcs.attribute09,0) AS other_allowances
        , IFNULL(hdcs.attribute10,0) AS subsidies
        , IFNULL(hdcs.attribute11,0) AS transportation_expenses
        , IFNULL(hdcs.attribute12,0) AS meals_expenses
        , IFNULL(hb.bonus_amount,0) AS bonus_amount
        , IFNULL(hdcs.basic_salary,0) + ifnull(hdcs.attribute01,0)+ifnull(hdcs.attribute15,0)  + IFNULL(hdcs.attribute02,0) + IFNULL(hdcs.attribute03,0)
		  + ifnull(hdcs.attribute04,0) + ifnull(hdcs.attribute18,0) + IFNULL(hdcs.attribute05,0) + IFNULL(hdcs.attribute06,0) + IFNULL(hdcs.attribute07,0)
		  + IFNULL(hdcs.attribute08,0) + IFNULL(hdcs.attribute09,0) + IFNULL(hdcs.attribute10,0) + IFNULL(hdcs.attribute11,0) 
		  + IFNULL(hdcs.attribute12,0) + IFNULL(hb.bonus_amount,0)	AS salary_sum
		, IFNULL(hdt.AM_DEDUCT01,0) AS national_pension
		, IFNULL(hdt.AM_DEDUCT02,0) AS health_insurance
		, IFNULL(hdt.AM_DEDUCT03,0) AS care_insurance
		, IFNULL(hdt.AM_DEDUCT04,0) AS employment_insurance
		, IFNULL(hdt.AM_DEDUCT05,0) AS advance
		, IFNULL(hdt.AM_DEDUCT06,0) AS other_tax
		, IFNULL(hdt.AM_DEDUCT07,0) AS gyeongjobi
		, IFNULL(hdt.AM_DEDUCT08,0) + IFNULL(hdt.AM_DEDUCT09,0) AS yearend
		, IFNULL(hdt.AM_DEDUCT10,0) AS health_insurance_settlement
		, IFNULL(hdt.AM_DEDUCT11,0) AS care_insurance_settlement
		, IFNULL(hdt.AM_DEDUCT12,0) AS holiday_tax
		, IFNULL(hdt.AM_INCOMTAX,0) AS incomtax
		, IFNULL(hdt.AM_RESIDTAX,0) AS residtax
		, IFNULL(hdt.AM_DEDUCT01,0) + IFNULL(hdt.AM_DEDUCT02,0) + IFNULL(hdt.AM_DEDUCT03,0) + IFNULL(hdt.AM_DEDUCT04,0)
		  + IFNULL(hdt.AM_DEDUCT05,0) + IFNULL(hdt.AM_DEDUCT06,0) + IFNULL(hdt.AM_DEDUCT07,0) + IFNULL(hdt.AM_DEDUCT08,0) 
		  + IFNULL(hdt.AM_DEDUCT09,0) + IFNULL(hdt.AM_DEDUCT10,0) + IFNULL(hdt.AM_DEDUCT11,0) + IFNULL(hdt.AM_DEDUCT12,0)
		  + IFNULL(hdt.AM_INCOMTAX,0) + IFNULL(hdt.AM_RESIDTAX,0) AS tax_sum
		, IFNULL(hdt.DT_PAY,'00000000') AS dt_pay
		, hdcs.yyyymm
        FROM   hr_dh_calc_salary hdcs
        INNER JOIN hr_dh_monthly_keun_tae hdmkt
	    ON hdcs.company_id = hdmkt.company_id 
	    AND hdcs.employee_id = hdmkt.employee_id 
	    AND hdcs.yyyymm = hdmkt.yyyymm 
        INNER JOIN fnd_business_est fbe
        ON hdcs.company_id = fbe.company_id
        INNER JOIN hr_employee he
        ON hdcs.company_id  = he.company_id
        AND hdcs.employee_id  = he.employee_id
        AND hdcs.yyyymm  = he.attribute1
        AND he.est_id = fbe.est_id
        INNER JOIN hr_department  hd
        ON he.company_id = hd.company_id
        AND he.department_id = hd.department_id
        AND he.attribute1  = hd.attribute2
        INNER JOIN fnd_code fc02
        ON fc02.company_id  = he.company_id
        AND fc02.code_field = 'HR_A0003'
        INNER JOIN fnd_code_detail fcd02
        ON fcd02.company_id  = he.company_id
        AND fcd02.code_id = fc02.code_id
        AND fcd02.defined_cd = he.position_code
        LEFT JOIN hr_bonus hb
        ON he.company_id = hb.company_id
        AND he.employee_id = hb.employee_id
        AND he.attribute1 = hb.yyyymm
        LEFT JOIN hr_dh_tax hdt 
        ON he.company_id = hdt.company_id
        AND he.employee_id = hdt.employee_id
        AND he.attribute1 = hdt.yyyymm
        WHERE  he.company_id = #{companyId}
        AND   he.attribute1  = #{yyyymm}
        AND	  he.employee_number = #{employeeNumber}
	</select>
</mapper>