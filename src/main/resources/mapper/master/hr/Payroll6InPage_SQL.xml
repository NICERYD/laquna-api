<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.seedit.domain.mapper.seedit.Payroll6InPageDao">
	
	<select id="getPayroll6InPageList" parameterType="map" resultType="kr.co.seedit.domain.hr.dto.Payroll6InPageDto">
		SELECT -- he.hire_date -- 입사년일
			CONCAT(he.hire_date, CASE WHEN CONCAT(SUBSTRING(he.retire_date,1,4),SUBSTRING(he.retire_date,6,2)) = hdcs.yyyymm THEN CONCAT(' ',he.retire_date) ELSE '' END) as hire_date
			, CASE
				WHEN CONCAT(SUBSTRING(he.hire_date,1,4),SUBSTRING(he.hire_date,6,2)) = hdcs.yyyymm THEN 'RETIRE'
				WHEN CONCAT(SUBSTRING(he.retire_date,1,4),SUBSTRING(he.retire_date,6,2)) = hdcs.yyyymm THEN 'NEW'
				ELSE ''
				END as hire_div
			, fcd02.defined_name  -- 직급
, CONCAT('[',fcd06.defined_cd,']') -- 직군
, he.department_id -- 부서 아이디
, hd.department_name
			, '' AS department_name -- 시급제 부서(ex.머시닝)
			, he.korean_name  -- 이름
			, he.employee_type -- 100 연봉제
			, hdcs.basic_salary as basic_amount -- 기본금
			, hdcs.attribute20 as hourly_pay -- 시급(시급제 전용)
			, hdcs.attribute01 as annual_allowance -- 연차수당
--			,  as annual_leave -- 연차수당(시간)
			, hdmkt.annual_leave_used as rt_annual_leave_used -- 연차사용횟수(시간)
			, hdmkt.annual_leave_used_day as rt_annual_leave_used_day -- 연차일자(시간)
			, hdcs.attribute15 as half_time_allowance -- 반차수당
			, hdmkt.half_leave_used as rt_half_time -- 반차사용횟수(시간)
			, hdmkt.half_leave_used_day as rt_half_day -- 반차사용일자(시간)
			, hdcs.attribute02 as overtime_allowance01 -- 연장1 수당
--			,  as rt_over_time01 -- 연장1 시간
			, hdmkt.overtime_daytime as rt_over_day_time_hours -- 연장1 - 주간(시간)
			, hdmkt.overtime_nighttime as rt_over_night_time_hours -- 연장1 - 야간(시간)
			, hdcs.attribute03 as overtime_allowance02 -- 연장2 수당(년봉제 전용)
			, hdcs.attribute04 as night_allowance01 -- 야간1 수당
			, hdmkt.night_daytime as rt_n_s_day_time_hours -- 야간1- 주간(시간)
			, hdmkt.night_nighttime as rt_n_s_night_time_hours -- 야간1- 야간(시간)
			, hdcs.attribute05 as night_allowance02 -- 야간2 수당(년봉제 전용)
--			,  as rt_night_shift02 -- 야간2 시간(년봉제 전용)
			, hdcs.attribute06 as holiday_allowance01 -- 휴일1 수당
			, hdmkt.holiday_saturday as rt_holiday_saturday01 -- 휴일1-토요일(시간)
			, hdmkt.holiday_sunday as rt_holiday_sunday01 -- 휴일1-일요일(시간)
			, IFNULL(hdcs.attribute07,0) as holiday_allowance02 -- 휴일2(년봉제 전용)
--			,  as rt_holiday02 -- 휴일2(시간)(년봉제 전용)
			, IFNULL(hdcs.attribute11,0) as transportation_amount -- 보조금-교통비(시급제 전용)
--			,  as rt_transportation -- 보조금-교통비(시간)(시급제 전용)
			, IFNULL(hdcs.attribute12,0) as meals_amount -- 보조금-식대(시급제 전용)
--			,  as rt_meal -- 보조금-식대(시간)(시급제 전용)
			, hdcs.attribute09 as other_amount -- 기타
--			,  as rt_other -- 기타(시간)
			, IFNULL(hdcs.attribute14,0) as late_amount -- 지각차감금액(시급제 전용)
			, hdmkt.late_time as rt_late_time -- 지각시간(시간)
			, hdmkt.late_day as rt_late_day -- 지각일자(시간)
			, hdcs.attribute13 as early_leave_amount -- 조퇴차감금액(시급제 전용)
			, hdmkt.early_leave_time as rt_early_leave_time -- 조퇴시간(시간)(시급제 전용)
			, hdmkt.early_leave_day as rt_early_leave_day -- 조퇴일자(시간)(시급제 전용)
			, hdcs.attribute17 as outer_amount -- 외출차감금액(시급제 전용)
			, hdmkt.outer_time as rt_outer_time -- 외출시간(시간)(시급제 전용)
			, hdmkt.outer_day as rt_outer_day -- 외출일자(시간)(시급제 전용)
			, hdmkt.total_time as rt_total_time -- 총근무시간(시간) 
			, CASE he.employee_type
				WHEN 100 THEN
					IFNULL(hdcs.basic_salary,0) -- as basic_amount -- 기본금
					+ IFNULL(hdcs.attribute02,0) -- as overtime_allowance01 -- 연장1 수당
					+ IFNULL(hdcs.attribute03,0) -- as overtime_allowance02 -- 연장2 수당(년봉제 전용)
					+ IFNULL(hdcs.attribute04,0) -- as night_allowance01 -- 야간1 수당
					+ IFNULL(hdcs.attribute05,0) -- as night_allowance02 -- 야간2 수당(년봉제 전용)
					+ IFNULL(hdcs.attribute06,0) -- as holiday_allowance01 -- 휴일1 수당
					+ IFNULL(hdcs.attribute07,0) -- as holiday_allowance02 -- 휴일2(년봉제 전용)
					+ IFNULL(hdcs.attribute01,0) -- as annual_allowance -- 연차수당
					+ IFNULL(hdcs.attribute15,0) -- as half_time_allowance -- 반차수당
				WHEN 200 THEN
					IFNULL(hdcs.basic_salary,0) -- as basic_amount -- 기본금
					+ IFNULL(hdcs.attribute01,0) -- as annual_allowance -- 연차수당
					+ IFNULL(hdcs.attribute02,0) -- as overtime_allowance01 -- 연장1 수당
					+ IFNULL(hdcs.attribute04,0) -- as night_allowance01 -- 야간1 수당
					+ IFNULL(hdcs.attribute06,0) -- as holiday_allowance01 -- 휴일1 수당
					+ IFNULL(hdcs.attribute11,0) -- as transportation_amount -- 보조금-교통비(시급제 전용)
					+ IFNULL(hdcs.attribute12,0) -- as meals_amount -- 보조금-식대(시급제 전용)
					+ IFNULL(hdcs.attribute15,0) -- as half_time_allowance -- 반차수당
					+ IFNULL(hdcs.attribute13,0) -- as early_leave_amount -- 조퇴차감금액(시급제 전용)
					+ IFNULL(hdcs.attribute14,0) -- as late_amount -- 지각차감금액(시급제 전용)
					+ IFNULL(hdcs.attribute17,0) -- as outer_amount -- 외출차감금액(시급제 전용)
				END as total_salary -- 합계
		FROM  hr_dh_calc_salary hdcs
		INNER JOIN hr_dh_monthly_keun_tae hdmkt
		ON hdcs.company_id = hdmkt.company_id 
		AND hdcs.employee_id = hdmkt.employee_id 
		AND hdcs.yyyymm = hdmkt.yyyymm 
		INNER JOIN hr_employee he
		ON hdcs.company_id = he.company_id 
		AND hdcs.employee_id = he.employee_id 
		AND hdcs.yyyymm = he.attribute1 
		-- 직급
		INNER JOIN fnd_code fc02
		ON fc02.company_id  = he.company_id 
		AND fc02.code_field = 'HR_A0003'
		INNER JOIN fnd_code_detail fcd02
		ON fcd02.company_id  = he.company_id 
		AND fcd02.code_id = fc02.code_id 
		AND fcd02.defined_cd = he.position_code 
		-- 직군
		INNER JOIN fnd_code fc06
		ON fc06.company_id  = he.company_id 
		AND fc06.code_field = 'HR_A0006'
		LEFT JOIN fnd_code_detail fcd06
		ON fcd06.company_id  = he.company_id 
		AND fcd06.code_id = fc06.code_id
		AND fcd06.defined_cd = he.position_type
		-- AND fcd06.defined_cd = 100 -- 임원
		LEFT JOIN hr_department hd
		ON hd.department_id = he.department_id AND hd.company_id = '5'
		WHERE hdcs.company_id  = #{companyId}
		AND   he.employee_type = #{employeeType}
		AND   hdcs.yyyymm = #{yyyymm}
		ORDER BY IFNULL(fcd06.defined_cd, '99999') -- 직군
		, he.department_id -- 부서 아이디
		, fcd02.defined_name  -- 직급
		, he.korean_name
	</select>
	
</mapper>